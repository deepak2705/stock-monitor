<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indian Stock Market Monitor</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Stock Monitor">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiM2NjdlZWEiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IndoaXRlIiBzdHJva2Utd2lkdGg9IjIiPgo8cGF0aCBkPSJtMyAzIDMgOSA0LTYgNCA2IDItMy02IDMgMyA5Ii8+CjxyZWN0IHg9IjQiIHk9IjE4IiB3aWR0aD0iMTYiIGhlaWdodD0iMiIvPgo8L3N2Zz4KPC9zdmc+">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #667eea;
            --primary-dark: #5a67d8;
            --secondary: #764ba2;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --dark: #1a202c;
            --light: #f7fafc;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* Animated background particles */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 200, 255, 0.2) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(1deg); }
            66% { transform: translateY(10px) rotate(-1deg); }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        /* Glassmorphism header */
        .header {
            text-align: center;
            margin-bottom: 50px;
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            padding: 40px 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: rotate 10s linear infinite;
            pointer-events: none;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        .header h1 {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #ffffff, #e2e8f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.5);
            line-height: 1.1;
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.3rem;
            font-weight: 400;
            margin-bottom: 20px;
        }

        .api-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 8px 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-top: 15px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .api-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--warning);
            animation: pulse-indicator 2s infinite;
        }

        .api-status.connected .api-indicator {
            background: var(--success);
        }

        .api-status.error .api-indicator {
            background: var(--danger);
        }

        /* Modern dashboard grid */
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 35px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .card:hover::before {
            left: 100%;
        }

        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 35px 70px rgba(0, 0, 0, 0.15);
        }

        .card h2 {
            color: var(--gray-800);
            margin-bottom: 25px;
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .card-icon {
            width: 35px;
            height: 35px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .add-stock-icon {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .settings-icon {
            background: linear-gradient(135deg, var(--warning), #ff6b6b);
        }

        /* Enhanced form controls */
        .input-group {
            margin-bottom: 25px;
            position: relative;
        }

        .input-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--gray-700);
            font-weight: 600;
            font-size: 0.95rem;
            letter-spacing: 0.5px;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--gray-200);
            border-radius: 15px;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            background: rgba(255, 255, 255, 1);
            transform: translateY(-2px);
        }

        /* Premium buttons */
        .btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 15px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin-right: 12px;
            margin-bottom: 12px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover:not(:disabled)::before {
            left: 100%;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .btn:active:not(:disabled) {
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--danger), #c53030);
            box-shadow: 0 10px 30px rgba(239, 68, 68, 0.3);
        }

        .btn-secondary:hover:not(:disabled) {
            box-shadow: 0 15px 40px rgba(239, 68, 68, 0.4);
        }

        .loading-spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 2px solid white;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modern stock list */
        .stock-list {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 35px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 30px;
        }

        .stock-list h2 {
            color: var(--gray-800);
            margin-bottom: 30px;
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .watchlist-icon {
            background: linear-gradient(135deg, var(--success), #22c55e);
            width: 35px;
            height: 35px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stock-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 25px;
            border: 2px solid var(--gray-100);
            border-radius: 20px;
            margin-bottom: 15px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(249, 250, 251, 0.9));
            backdrop-filter: blur(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .stock-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .stock-item:hover {
            transform: translateX(8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }

        .stock-item:hover::before {
            transform: scaleY(1);
        }

        .stock-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .stock-symbol {
            font-weight: 700;
            color: var(--gray-800);
            font-size: 1.3rem;
            letter-spacing: 0.5px;
        }

        .stock-price {
            color: var(--gray-600);
            font-size: 1rem;
            font-weight: 500;
        }

        .stock-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .price-change {
            font-weight: 700;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 6px;
            min-width: 80px;
            justify-content: center;
        }

        .price-up {
            background: linear-gradient(135deg, #dcfce7, #bbf7d0);
            color: #166534;
            border: 1px solid #22c55e;
        }

        .price-down {
            background: linear-gradient(135deg, #fef2f2, #fecaca);
            color: #991b1b;
            border: 1px solid #ef4444;
        }

        .price-neutral {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            color: #475569;
            border: 1px solid #94a3b8;
        }

        .last-updated {
            font-size: 0.8rem;
            color: var(--gray-500);
            margin-top: 4px;
        }

        /* Enhanced status indicators */
        .status {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 30px;
            padding: 25px;
            border-radius: 20px;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(34, 197, 94, 0.1));
            border: 2px solid rgba(16, 185, 129, 0.2);
            backdrop-filter: blur(10px);
            font-weight: 600;
            color: #065f46;
        }

        .status.error {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1));
            border: 2px solid rgba(239, 68, 68, 0.2);
            color: #991b1b;
        }

        .status-indicator {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse-indicator 2s infinite;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
        }

        .status.error .status-indicator {
            background: var(--danger);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
        }

        @keyframes pulse-indicator {
            0%, 100% { 
                opacity: 1; 
                transform: scale(1);
            }
            50% { 
                opacity: 0.7; 
                transform: scale(1.2);
            }
        }

        /* Premium alert log */
        .alert-log {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 35px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .alert-log h2 {
            color: var(--gray-800);
            margin-bottom: 30px;
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .alerts-icon {
            background: linear-gradient(135deg, var(--warning), #f59e0b);
            width: 35px;
            height: 35px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .alert-item {
            padding: 20px 25px;
            border-left: 5px solid var(--primary);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
            margin-bottom: 15px;
            border-radius: 0 15px 15px 0;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        .alert-item:hover {
            transform: translateX(5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.1);
        }

        .alert-time {
            font-size: 0.85rem;
            color: var(--gray-500);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .alert-message {
            color: var(--gray-800);
            font-weight: 500;
            line-height: 1.5;
        }

        /* Stock search dropdown */
        .stock-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border: 2px solid var(--gray-200);
            border-top: none;
            border-radius: 0 0 15px 15px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .stock-dropdown.show {
            display: block;
        }

        .dropdown-item {
            padding: 15px 20px;
            cursor: pointer;
            border-bottom: 1px solid var(--gray-100);
            transition: all 0.2s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dropdown-item:hover {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            transform: translateX(5px);
        }

        .dropdown-item:last-child {
            border-bottom: none;
            border-radius: 0 0 15px 15px;
        }

        .stock-name {
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 4px;
        }

        .stock-symbol-small {
            font-size: 0.85rem;
            color: var(--gray-500);
            font-weight: 500;
        }

        .no-results {
            padding: 20px;
            text-align: center;
            color: var(--gray-500);
            font-style: italic;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--secondary));
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            top: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            color: var(--gray-800);
            padding: 20px 25px;
            border-radius: 15px;
            z-index: 1000;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-weight: 600;
            animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .toast.success {
            border-left: 5px solid var(--success);
        }

        .toast.error {
            border-left: 5px solid var(--danger);
        }

        .toast.info {
            border-left: 5px solid var(--info);
        }

        @keyframes slideInRight {
            from { 
                transform: translateX(100%) scale(0.8); 
                opacity: 0; 
            }
            to { 
                transform: translateX(0) scale(1); 
                opacity: 1; 
            }
        }

        @keyframes slideOutRight {
            from { 
                transform: translateX(0) scale(1); 
                opacity: 1; 
            }
            to { 
                transform: translateX(100%) scale(0.8); 
                opacity: 0; 
            }
        }

        /* Flash alert animation */
        @keyframes flashAlert {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .card, .stock-list, .alert-log {
                padding: 25px;
            }

            .stock-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .stock-controls {
                width: 100%;
                justify-content: space-between;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .header p {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <h1>üìä Indian Stock Monitor</h1>
                <p>Real-time alerts for Indian stock market with Finnhub API</p>
                <div class="api-status" id="apiStatus">
                    <div class="api-indicator"></div>
                    <span>Loading API status...</span>
                </div>
            </div>
        </div>

        <div class="dashboard">
            <div class="card">
                <h2>
                    <div class="card-icon add-stock-icon">üîë</div>
                    API Configuration
                </h2>
                <div class="input-group">
                    <label for="apiKey">Finnhub API Key</label>
                    <input type="password" id="apiKey" placeholder="Enter your Finnhub API key" 
                           oninput="validateApiKey()">
                    <small style="color: var(--gray-500); margin-top: 8px; display: block;">
                        Get your free API key from <a href="https://finnhub.io/" target="_blank" style="color: var(--primary);">finnhub.io</a> (60 calls/minute free)
                    </small>
                </div>
                <button class="btn" onclick="testApiConnection()" id="testApiBtn">
                    <span>Test Connection</span>
                </button>
                <button class="btn btn-secondary" onclick="clearApiKey()">Clear API Key</button>
            </div>

            <div class="card">
                <h2>
                    <div class="card-icon add-stock-icon">üìà</div>
                    Add Indian Stock
                </h2>
                <div class="input-group">
                    <label for="stockSymbol">Search Indian Stocks</label>
                    <div style="position: relative;">
                        <input type="text" id="stockSymbol" placeholder="Type company name or symbol (e.g., Reliance, TCS, Infosys)" 
                               oninput="searchIndianStocks()" autocomplete="off">
                        <div id="stockDropdown" class="stock-dropdown"></div>
                    </div>
                    <small style="color: var(--gray-500); margin-top: 8px; display: block;">
                        Search by company name or stock symbol. NSE symbols will be added automatically.
                    </small>
                </div>
                <button class="btn" onclick="addStock()" id="addStockBtn" disabled>
                    <span>Add to Watchlist</span>
                </button>
                <button class="btn btn-secondary" onclick="removeAllStocks()">Clear All</button>
            </div>

            <div class="card">
                <h2>
                    <div class="card-icon settings-icon">‚öôÔ∏è</div>
                    Alert Settings
                </h2>
                <div class="input-group">
                    <label for="alertEmail">Email Address</label>
                    <input type="email" id="alertEmail" placeholder="your.email@gmail.com">
                </div>
                <div class="input-group">
                    <label for="alertPhone">Phone Number (SMS)</label>
                    <input type="tel" id="alertPhone" placeholder="+91-9876543210">
                </div>
                <div class="input-group">
                    <label for="alertThreshold">Alert Threshold (%)</label>
                    <input type="number" id="alertThreshold" min="0.1" max="50" step="0.1" value="5" placeholder="5.0">
                </div>
                <div class="input-group">
                    <label for="marketHours">Market Hours</label>
                    <select id="marketHours">
                        <option value="auto">Auto (9:15 AM - 3:30 PM IST)</option>
                        <option value="extended">Extended (9:00 AM - 4:00 PM IST)</option>
                        <option value="24x7">24x7 Monitoring</option>
                        <option value="custom">Custom Hours</option>
                    </select>
                </div>
                <div class="input-group" id="customHoursGroup" style="display: none;">
                    <label>Custom Market Hours (IST)</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="time" id="startTime" value="09:15">
                        <span style="color: var(--gray-600); font-weight: 600;">to</span>
                        <input type="time" id="endTime" value="15:30">
                    </div>
                </div>
                <button class="btn" onclick="toggleMonitoring()" id="monitorBtn">Start Monitoring</button>
            </div>
        </div>

        <div class="stock-list">
            <h2>
                <div class="watchlist-icon">üëÅÔ∏è</div>
                Your Watchlist
            </h2>
            <div id="stockItems">
                <p style="text-align: center; color: var(--gray-500); padding: 40px; font-size: 1.1rem;">
                    No stocks added yet. Add some stocks to get started! üöÄ
                </p>
            </div>
        </div>

        <div class="status" id="monitoringStatus">
            <div class="status-indicator"></div>
            <span>Monitoring stopped. Configure API and add stocks to start monitoring.</span>
        </div>

        <div class="alert-log">
            <h2>
                <div class="alerts-icon">üö®</div>
                Real-Time Alerts
            </h2>
            <div id="alertLog">
                <p style="text-align: center; color: var(--gray-500); padding: 40px; font-size: 1.1rem;">
                    No alerts yet. Alerts will appear when stocks move beyond your threshold during market hours. ‚ö°
                </p>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let apiKey = '';
        let watchlist = [];
        let isMonitoring = false;
        let monitoringInterval;
        let basePrices = {};
        let marketHoursCheckInterval;
        let apiCallCount = 0;
        let lastApiReset = Date.now();
        let selectedStock = null;

        // Indian stock database for search
        const indianStocks = [
            { symbol: 'RELIANCE.NS', name: 'Reliance Industries Limited', keywords: ['reliance', 'ril'] },
            { symbol: 'TCS.NS', name: 'Tata Consultancy Services Limited', keywords: ['tcs', 'tata consultancy'] },
            { symbol: 'INFY.NS', name: 'Infosys Limited', keywords: ['infosys', 'infy'] },
            { symbol: 'HDFCBANK.NS', name: 'HDFC Bank Limited', keywords: ['hdfc bank', 'hdfcbank'] },
            { symbol: 'ICICIBANK.NS', name: 'ICICI Bank Limited', keywords: ['icici bank', 'icicibank'] },
            { symbol: 'SBIN.NS', name: 'State Bank of India', keywords: ['sbi', 'state bank'] },
            { symbol: 'BHARTIARTL.NS', name: 'Bharti Airtel Limited', keywords: ['airtel', 'bharti'] },
            { symbol: 'ITC.NS', name: 'ITC Limited', keywords: ['itc'] },
            { symbol: 'KOTAKBANK.NS', name: 'Kotak Mahindra Bank Limited', keywords: ['kotak', 'kotak bank'] },
            { symbol: 'LT.NS', name: 'Larsen & Toubro Limited', keywords: ['larsen', 'lt', 'l&t'] },
            { symbol: 'ASIANPAINT.NS', name: 'Asian Paints Limited', keywords: ['asian paints'] },
            { symbol: 'MARUTI.NS', name: 'Maruti Suzuki India Limited', keywords: ['maruti', 'suzuki'] },
            { symbol: 'WIPRO.NS', name: 'Wipro Limited', keywords: ['wipro'] },
            { symbol: 'ULTRACEMCO.NS', name: 'UltraTech Cement Limited', keywords: ['ultratech', 'cement'] },
            { symbol: 'TITAN.NS', name: 'Titan Company Limited', keywords: ['titan'] },
            { symbol: 'NESTLEIND.NS', name: 'Nestle India Limited', keywords: ['nestle'] },
            { symbol: 'HINDUNILVR.NS', name: 'Hindustan Unilever Limited', keywords: ['hul', 'hindustan unilever'] },
            { symbol: 'BAJFINANCE.NS', name: 'Bajaj Finance Limited', keywords: ['bajaj finance'] },
            { symbol: 'AXISBANK.NS', name: 'Axis Bank Limited', keywords: ['axis bank'] },
            { symbol: 'HCLTECH.NS', name: 'HCL Technologies Limited', keywords: ['hcl', 'hcl tech'] },
            { symbol: 'SUNPHARMA.NS', name: 'Sun Pharmaceutical Industries Limited', keywords: ['sun pharma'] },
            { symbol: 'ONGC.NS', name: 'Oil and Natural Gas Corporation Limited', keywords: ['ongc', 'oil gas'] },
            { symbol: 'TATAMOTORS.NS', name: 'Tata Motors Limited', keywords: ['tata motors'] },
            { symbol: 'TATASTEEL.NS', name: 'Tata Steel Limited', keywords: ['tata steel'] },
            { symbol: 'POWERGRID.NS', name: 'Power Grid Corporation of India Limited', keywords: ['power grid', 'powergrid'] },
            { symbol: 'NTPC.NS', name: 'NTPC Limited', keywords: ['ntpc'] },
            { symbol: 'TECHM.NS', name: 'Tech Mahindra Limited', keywords: ['tech mahindra'] },
            { symbol: 'ADANIPORTS.NS', name: 'Adani Ports and Special Economic Zone Limited', keywords: ['adani ports'] },
            { symbol: 'JSWSTEEL.NS', name: 'JSW Steel Limited', keywords: ['jsw steel'] },
            { symbol: 'INDUSINDBK.NS', name: 'IndusInd Bank Limited', keywords: ['indusind bank'] }
        ];

        // Market hours configuration
        const marketSchedule = {
            auto: { start: '09:15', end: '15:30' },
            extended: { start: '09:00', end: '16:00' },
            '24x7': null,
            custom: null
        };

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedApiKey();
            updateApiStatus();
            
            // Show/hide custom hours input based on selection
            document.getElementById('marketHours').addEventListener('change', function() {
                const customGroup = document.getElementById('customHoursGroup');
                if (this.value === 'custom') {
                    customGroup.style.display = 'block';
                } else {
                    customGroup.style.display = 'none';
                }
                
                if (isMonitoring) {
                    updateMarketStatus();
                }
            });

            // Hide dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.input-group')) {
                    document.getElementById('stockDropdown').classList.remove('show');
                }
            });

            // Request notification permission
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }

            // Focus stock input
            setTimeout(() => {
                if (apiKey) {
                    document.getElementById('stockSymbol').focus();
                } else {
                    document.getElementById('apiKey').focus();
                }
            }, 500);
        });

        // Load saved API key from memory variable (persistent during session)
        function loadSavedApiKey() {
            // In a real application, you would implement secure storage
            // For now, we'll use a session-based approach
            const savedKey = sessionStorage.getItem('finnhub_api_key');
            if (savedKey) {
                apiKey = savedKey;
                document.getElementById('apiKey').value = savedKey;
                validateApiKey();
                testApiConnection(true); // Auto-test on load
            }
        }

        // Save API key to session storage
        function saveApiKey() {
            if (apiKey) {
                sessionStorage.setItem('finnhub_api_key', apiKey);
            }
        }

        // Clear API key
        function clearApiKey() {
            apiKey = '';
            document.getElementById('apiKey').value = '';
            sessionStorage.removeItem('finnhub_api_key');
            updateApiStatus('error', 'API key cleared');
            document.getElementById('addStockBtn').disabled = true;
            showAlert('API key cleared', 'info');
        }

        // Validate API key input
        function validateApiKey() {
            const inputKey = document.getElementById('apiKey').value.trim();
            const testBtn = document.getElementById('testApiBtn');
            const addBtn = document.getElementById('addStockBtn');
            
            if (inputKey.length > 10) { // Basic validation
                apiKey = inputKey;
                testBtn.disabled = false;
                updateApiStatus('warning', 'API key entered - Click test to verify');
            } else {
                apiKey = '';
                testBtn.disabled = true;
                addBtn.disabled = true;
                updateApiStatus('error', 'Please enter a valid API key');
            }
        }

        // Test API connection
        async function testApiConnection(silent = false) {
            if (!apiKey) {
                showAlert('Please enter an API key first', 'error');
                return;
            }

            const testBtn = document.getElementById('testApiBtn');
            const originalContent = testBtn.innerHTML;
            
            testBtn.disabled = true;
            testBtn.innerHTML = '<div class="loading-spinner"></div><span>Testing...</span>';

            try {
                const response = await fetch(`https://finnhub.io/api/v1/quote?symbol=RELIANCE.NS&token=${apiKey}`);
                
                if (response.status === 200) {
                    const data = await response.json();
                    
                    if (data.c && data.c > 0) { // Check if we got valid price data
                        updateApiStatus('connected', 'API Connected ‚úÖ');
                        document.getElementById('addStockBtn').disabled = false;
                        saveApiKey();
                        if (!silent) showAlert('‚úÖ API connection successful!', 'success');
                    } else {
                        throw new Error('Invalid response data');
                    }
                } else if (response.status === 401) {
                    throw new Error('Invalid API key');
                } else if (response.status === 429) {
                    throw new Error('API rate limit exceeded');
                } else {
                    throw new Error(`API error: ${response.status}`);
                }
            } catch (error) {
                updateApiStatus('error', `API Error: ${error.message}`);
                document.getElementById('addStockBtn').disabled = true;
                if (!silent) showAlert(`‚ùå API test failed: ${error.message}`, 'error');
            }

            testBtn.disabled = false;
            testBtn.innerHTML = originalContent;
        }

        // Update API status display
        function updateApiStatus(status = 'warning', message = 'API Ready - Enter your Finnhub API key') {
            const statusElement = document.getElementById('apiStatus');
            statusElement.className = `api-status ${status}`;
            statusElement.querySelector('span').textContent = message;
        }

        // Search Indian stocks
        function searchIndianStocks() {
            const searchTerm = document.getElementById('stockSymbol').value.toLowerCase().trim();
            const dropdown = document.getElementById('stockDropdown');
            
            if (searchTerm.length < 2) {
                dropdown.classList.remove('show');
                selectedStock = null;
                return;
            }

            const filteredStocks = indianStocks.filter(stock => {
                return stock.name.toLowerCase().includes(searchTerm) ||
                       stock.symbol.toLowerCase().includes(searchTerm) ||
                       stock.keywords.some(keyword => keyword.includes(searchTerm));
            });

            if (filteredStocks.length > 0) {
                dropdown.innerHTML = filteredStocks.slice(0, 8).map(stock => `
                    <div class="dropdown-item" onclick="selectStock('${stock.symbol}', '${stock.name}')">
                        <div>
                            <div class="stock-name">${stock.name}</div>
                            <div class="stock-symbol-small">${stock.symbol}</div>
                        </div>
                    </div>
                `).join('');
                dropdown.classList.add('show');
            } else {
                dropdown.innerHTML = '<div class="no-results">No Indian stocks found matching your search</div>';
                dropdown.classList.add('show');
            }
        }

        // Select stock from dropdown
        function selectStock(symbol, name) {
            selectedStock = { symbol, name };
            document.getElementById('stockSymbol').value = `${name} (${symbol})`;
            document.getElementById('stockDropdown').classList.remove('show');
        }

        // Add stock to watchlist
        async function addStock() {
            if (!apiKey) {
                showAlert('Please configure API key first', 'error');
                return;
            }

            if (!selectedStock) {
                showAlert('Please search and select a stock first', 'error');
                return;
            }

            const symbol = selectedStock.symbol;

            if (watchlist.some(item => item.symbol === symbol)) {
                showAlert('Stock already in watchlist', 'error');
                return;
            }

            // Get current price from Finnhub
            try {
                const quote = await fetchStockQuote(symbol);
                if (quote && quote.c > 0) {
                    watchlist.push({
                        symbol: symbol,
                        name: selectedStock.name,
                        currentPrice: quote.c,
                        previousClose: quote.pc,
                        change: ((quote.c - quote.pc) / quote.pc * 100),
                        lastUpdated: new Date()
                    });

                    basePrices[symbol] = quote.c;
                    document.getElementById('stockSymbol').value = '';
                    selectedStock = null;
                    
                    updateWatchlistDisplay();
                    showAlert(`‚úÖ Added ${symbol} to watchlist`, 'success');
                } else {
                    throw new Error('Invalid price data received');
                }
            } catch (error) {
                showAlert(`Failed to add stock: ${error.message}`, 'error');
            }
        }

        // Fetch stock quote from Finnhub
        async function fetchStockQuote(symbol) {
            if (!checkApiLimit()) {
                throw new Error('API rate limit reached (60 calls/minute)');
            }

            const response = await fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${apiKey}`);
            
            if (!response.ok) {
                throw new Error(`API request failed: ${response.status}`);
            }

            apiCallCount++;
            return await response.json();
        }

        // Check API rate limit (60 calls per minute)
        function checkApiLimit() {
            const now = Date.now();
            if (now - lastApiReset > 60000) { // Reset every minute
                apiCallCount = 0;
                lastApiReset = now;
            }
            return apiCallCount < 60;
        }

        // Remove stock from watchlist
        function removeStock(symbol) {
            watchlist = watchlist.filter(item => item.symbol !== symbol);
            delete basePrices[symbol];
            updateWatchlistDisplay();
            showAlert(`üóëÔ∏è Removed ${symbol} from watchlist`, 'info');
        }

        // Remove all stocks
        function removeAllStocks() {
            if (watchlist.length === 0) {
                showAlert('Watchlist is already empty', 'error');
                return;
            }
            
            if (confirm('Are you sure you want to remove all stocks?')) {
                watchlist = [];
                basePrices = {};
                updateWatchlistDisplay();
                showAlert('üßπ Cleared all stocks from watchlist', 'info');
            }
        }

        // Update watchlist display
        function updateWatchlistDisplay() {
            const container = document.getElementById('stockItems');
            
            if (watchlist.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--gray-500); padding: 40px; font-size: 1.1rem;">No stocks added yet. Add some stocks to get started! üöÄ</p>';
                return;
            }

            container.innerHTML = watchlist.map(stock => {
                const changeClass = stock.change > 0 ? 'price-up' : stock.change < 0 ? 'price-down' : 'price-neutral';
                const changeSymbol = stock.change > 0 ? '‚ñ≤' : stock.change < 0 ? '‚ñº' : '‚óè';
                const changePrefix = stock.change > 0 ? '+' : '';
                
                return `
                    <div class="stock-item">
                        <div class="stock-info">
                            <div class="stock-symbol">${stock.symbol}</div>
                            <div style="font-size: 0.9rem; color: var(--gray-600); margin-bottom: 4px;">${stock.name}</div>
                            <div class="stock-price">‚Çπ${stock.currentPrice.toFixed(2)}</div>
                            <div class="last-updated">Updated: ${stock.lastUpdated.toLocaleTimeString('en-IN')}</div>
                        </div>
                        <div class="stock-controls">
                            <div class="price-change ${changeClass}">
                                ${changeSymbol} ${changePrefix}${stock.change.toFixed(2)}%
                            </div>
                            <button class="btn btn-secondary" onclick="removeStock('${stock.symbol}')" style="padding: 10px 18px; font-size: 0.9rem;">Remove</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Toggle monitoring
        function toggleMonitoring() {
            const email = document.getElementById('alertEmail').value;
            const phone = document.getElementById('alertPhone').value;
            
            if (!email && !phone) {
                showAlert('Please provide at least an email or phone number for alerts', 'error');
                return;
            }

            if (watchlist.length === 0) {
                showAlert('Please add some stocks to monitor', 'error');
                return;
            }

            if (!apiKey) {
                showAlert('Please configure API key first', 'error');
                return;
            }

            if (isMonitoring) {
                stopMonitoring();
            } else {
                startMonitoring();
            }
        }

        // Start monitoring
        function startMonitoring() {
            const threshold = parseFloat(document.getElementById('alertThreshold').value);
            
            if (isNaN(threshold) || threshold <= 0) {
                showAlert('Please enter a valid threshold percentage (greater than 0)', 'error');
                return;
            }
            
            isMonitoring = true;
            document.getElementById('monitorBtn').textContent = 'Stop Monitoring';
            
            // Start market hours checking
            marketHoursCheckInterval = setInterval(updateMarketStatus, 30000);
            updateMarketStatus();
            
            // Start stock monitoring every minute (Finnhub rate limit)
            monitoringInterval = setInterval(() => {
                if (isMarketOpen()) {
                    checkStocks();
                }
            }, 60000); // 1 minute interval
            
            showAlert('üöÄ Real-time stock monitoring started!', 'success');
        }

        // Stop monitoring
        function stopMonitoring() {
            isMonitoring = false;
            document.getElementById('monitorBtn').textContent = 'Start Monitoring';
            
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
            }
            
            if (marketHoursCheckInterval) {
                clearInterval(marketHoursCheckInterval);
            }
            
            updateMarketStatus();
            showAlert('‚èπÔ∏è Stock monitoring stopped', 'info');
        }

        // Check if market is open
        function isMarketOpen() {
            const marketMode = document.getElementById('marketHours').value;
            
            if (marketMode === '24x7') {
                return true;
            }
            
            const now = new Date();
            const currentTime = now.toTimeString().slice(0, 5);
            const currentDay = now.getDay();
            
            // Check if it's a weekend
            if (currentDay === 0 || currentDay === 6) {
                return false;
            }
            
            let startTime, endTime;
            
            if (marketMode === 'custom') {
                startTime = document.getElementById('startTime').value;
                endTime = document.getElementById('endTime').value;
            } else {
                const schedule = marketSchedule[marketMode];
                startTime = schedule.start;
                endTime = schedule.end;
            }
            
            return currentTime >= startTime && currentTime <= endTime;
        }

        // Update market status
        function updateMarketStatus() {
            const isOpen = isMarketOpen();
            const statusElement = document.getElementById('monitoringStatus');
            
            if (!isMonitoring) {
                statusElement.className = 'status error';
                statusElement.innerHTML = '<div class="status-indicator"></div><span>Monitoring stopped. Configure API and add stocks to start monitoring.</span>';
                return;
            }
            
            if (isOpen) {
                statusElement.className = 'status';
                statusElement.innerHTML = '<div class="status-indicator"></div><span>üî¥ LIVE - Market is OPEN, monitoring active (1-minute updates)</span>';
            } else {
                statusElement.className = 'status error';
                const nextOpen = getNextMarketOpen();
                statusElement.innerHTML = `<div class="status-indicator"></div><span>üì¥ Market CLOSED - Monitoring paused until ${nextOpen}</span>`;
            }
        }

        // Get next market opening time
        function getNextMarketOpen() {
            const marketMode = document.getElementById('marketHours').value;
            if (marketMode === '24x7') return 'Always Open';
            
            const now = new Date();
            
            let startTime;
            if (marketMode === 'custom') {
                startTime = document.getElementById('startTime').value;
            } else {
                startTime = marketSchedule[marketMode].start;
            }
            
            if (now.getDay() === 5 && now.getHours() >= 15) {
                return `Monday ${startTime}`;
            }
            
            if (now.getDay() === 0 || now.getDay() === 6) {
                return `Monday ${startTime}`;
            }
            
            return `Tomorrow ${startTime}`;
        }

        // Check stocks for price changes
        async function checkStocks() {
            const threshold = parseFloat(document.getElementById('alertThreshold').value);
            
            for (const stock of watchlist) {
                try {
                    const quote = await fetchStockQuote(stock.symbol);
                    
                    if (quote && quote.c > 0) {
                        const oldPrice = stock.currentPrice;
                        const newPrice = quote.c;
                        const basePrice = basePrices[stock.symbol];
                        
                        // Update stock data
                        stock.currentPrice = newPrice;
                        stock.previousClose = quote.pc;
                        stock.change = ((newPrice - quote.pc) / quote.pc * 100);
                        stock.lastUpdated = new Date();
                        
                        // Check for threshold breach
                        const percentChange = ((newPrice - basePrice) / basePrice) * 100;
                        
                        if (Math.abs(percentChange) >= threshold) {
                            triggerAlert(stock.symbol, newPrice, percentChange);
                            basePrices[stock.symbol] = newPrice; // Reset base price after alert
                        }
                    }
                } catch (error) {
                    console.error(`Error fetching data for ${stock.symbol}:`, error);
                }
            }
            
            updateWatchlistDisplay();
        }

        // Trigger alert
        function triggerAlert(symbol, price, change) {
            const direction = change > 0 ? 'üìà UP' : 'üìâ DOWN';
            const alertType = change > 0 ? 'GAIN' : 'LOSS';
            const timestamp = new Date().toLocaleTimeString('en-IN');
            const threshold = parseFloat(document.getElementById('alertThreshold').value);
            
            const message = `üö® ${threshold}% ALERT: ${symbol} moved ${Math.abs(change).toFixed(2)}% ${direction} to ‚Çπ${price.toFixed(2)} at ${timestamp}`;
            
            // Simulate real-time alert
            simulateRealTimeAlert(symbol, message, alertType);
            addToAlertLog(message);
            flashAlert(symbol, change);
        }

        // Simulate real-time alert
        function simulateRealTimeAlert(symbol, message, alertType) {
            const email = document.getElementById('alertEmail').value;
            const phone = document.getElementById('alertPhone').value;
            
            console.log('üìß EMAIL ALERT:', message, 'to', email);
            console.log('üì± SMS ALERT:', message, 'to', phone);
            
            // Browser notification
            if ('Notification' in window && Notification.permission === 'granted') {
                const notification = new Notification(`${alertType}: ${symbol}`, {
                    body: message,
                    icon: alertType === 'GAIN' ? 'üìà' : 'üìâ',
                    requireInteraction: true,
                    tag: symbol
                });
                
                setTimeout(() => notification.close(), 10000);
            }
        }

        // Flash visual alert
        function flashAlert(symbol, change) {
            const flash = document.createElement('div');
            flash.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: ${change > 0 ? 'rgba(16, 185, 129, 0.2)' : 'rgba(239, 68, 68, 0.2)'};
                z-index: 9999;
                animation: flashAlert 0.5s ease-in-out;
                pointer-events: none;
            `;
            
            document.body.appendChild(flash);
            setTimeout(() => flash.remove(), 500);
        }

        // Add alert to log
        function addToAlertLog(message) {
            const logContainer = document.getElementById('alertLog');
            const now = new Date().toLocaleString('en-IN');
            
            if (logContainer.innerHTML.includes('No alerts yet')) {
                logContainer.innerHTML = '';
            }
            
            const alertItem = document.createElement('div');
            alertItem.className = 'alert-item';
            alertItem.innerHTML = `
                <div class="alert-time">${now}</div>
                <div class="alert-message">${message}</div>
            `;
            
            logContainer.insertBefore(alertItem, logContainer.firstChild);
            
            // Keep only last 10 alerts
            const alerts = logContainer.querySelectorAll('.alert-item');
            if (alerts.length > 10) {
                alerts[alerts.length - 1].remove();
            }
        }

        // Show toast notification
        function showAlert(message, type) {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
                setTimeout(() => toast.remove(), 400);
            }, 4000);
        }
    </script>
</body>
</html>
